# ๐ฌ ูุธุงู ูุต ุงูููุฏูู ุฅูู 60 ุซุงููุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงููุธุงู ูุณูุญ ูููุณุชุฎุฏููู ุจุฑูุน ููุฏูููุงุช ุณุชูุฑูุ ููููู ุชููุงุฆูุงู ุจูุต ุงูููุฏูู ุฅูู ุฃูู 60 ุซุงููุฉ ููุทุ ููุง ูููุฑ ูุณุงุญุฉ ุชุฎุฒูู ููุญุงูุธ ุนูู ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุชูุงุณูุฉ.

## โจ ุงููููุฒุงุช

- โ **ูุต ุชููุงุฆู** ููููุฏูู ุฅูู 60 ุซุงููุฉ
- โ **ุฏุนู ุตูุบ ูุชุนุฏุฏุฉ** (MP4, AVI, MOV, WMV, FLV, WebM, MKV)
- โ **ูุนุงูุฌุฉ ุฐููุฉ ููุฃุฎุทุงุก** ูุน fallback ุขูู
- โ **ุชูุธูู ุชููุงุฆู** ูููููุงุช ุงููุคูุชุฉ
- โ **ุชุญุณูู ุงูุฃุฏุงุก** ุจุงุณุชุฎุฏุงู copy codecs
- โ **ุฅุนุงุฏุฉ ุชุฑููุฒ** ุฅุฐุง ูุดู copy codecs
- โ **ุณุฌูุงุช ููุตูุฉ** ููุฑุงูุจุฉ ุงูุฃุฏุงุก

## ๐ ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

### 1. ุชุซุจูุช FFmpeg

#### Ubuntu/Debian:

```bash
sudo apt update
sudo apt install ffmpeg
```

#### CentOS/RHEL:

```bash
sudo yum install epel-release
sudo yum install ffmpeg
```

#### macOS:

```bash
brew install ffmpeg
```

#### Windows:

1. ุชุญููู FFmpeg ูู [ุงููููุน ุงูุฑุณูู](https://ffmpeg.org/download.html)
2. ุฅุถุงูุชู ุฅูู PATH

### 2. ุงูุชุญูู ูู ุงูุชุซุจูุช:

```bash
ffmpeg -version
ffprobe -version
```

### 3. ุชุซุจูุช ูุชุทูุจุงุช Python:

```bash
pip install -r requirements.txt
```

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### ุงุฎุชุจุงุฑ ุจุณูุท:

```bash
cd backend/story
python simple_test.py
```

### ุงุฎุชุจุงุฑ ูุชูุฏู:

```bash
cd backend/story
python test_video_trimming.py
```

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฑูุน ููุฏูู ูู ุฎูุงู API

```python
import requests

# ุฑูุน ููุฏูู
url = "http://localhost:8000/api/stories/create/"
files = {'file': open('video.mp4', 'rb')}
data = {'media_type': 'video'}

response = requests.post(url, files=files, data=data)
print(response.json())
```

### 2. ุงุณุชุฎุฏุงู ุงููุธุงู ุจุฑูุฌูุงู

```python
from story.video_processor import trim_video_to_60_seconds, is_video_file
from django.core.files import File

# ูุชุญ ููู ุงูููุฏูู
with open('video.mp4', 'rb') as video_file:
    django_file = File(video_file, name='video.mp4')

    # ุงูุชุญูู ูู ููุน ุงูููู
    if is_video_file(django_file):
        # ูุต ุงูููุฏูู
        trimmed_file = trim_video_to_60_seconds(django_file)

        # ุญูุธ ุงูููุฏูู ุงูููุทูุน
        story = Story.objects.create(
            user=user,
            file=trimmed_file,
            media_type='video',
            duration=60,
            is_trimmed=True
        )
```

## ๐ง ุงูุจููุฉ ุงูุชูููุฉ

### ุงููููุงุช ุงูุฑุฆูุณูุฉ:

1. **`video_processor.py`** - ูุนุงูุฌ ุงูููุฏูู ุงูุฑุฆูุณู

   - `trim_video_to_60_seconds()` - ูุต ุงูููุฏูู
   - `is_video_file()` - ุงูุชุญูู ูู ููุน ุงูููู
   - `should_trim_video()` - ุงูุชุญูู ูู ุงูุญุงุฌุฉ ูููุต
   - `get_video_duration()` - ุงูุญุตูู ุนูู ูุฏุฉ ุงูููุฏูู

2. **`views.py`** - ูุนุงูุฌ ุงูุทูุจุงุช

   - `StoryCreateView` - ุฑูุน ุงูุณุชูุฑู
   - ูุนุงูุฌุฉ ุชููุงุฆูุฉ ููููุฏูู

3. **`models.py`** - ูููุฐุฌ ุงูุจูุงูุงุช
   - `Story` - ูููุฐุฌ ุงูุณุชูุฑู
   - `is_trimmed` - ุนูุงูุฉ ุงููุต
   - `duration` - ูุฏุฉ ุงูููุฏูู

## โ๏ธ ุฎูุงุฑุฒููุฉ ุงููุต

### ุงูุฎุทูุงุช ุงูุชูุตูููุฉ:

1. **ุงูุชุญูู ูู ููุน ุงูููู**

   ```python
   if is_video_file(file):
       # ูุนุงูุฌุฉ ุงูููุฏูู
   ```

2. **ุงูุชุญูู ูู ุงูุญุงุฌุฉ ูููุต**

   ```python
   if should_trim_video(file):
       # ูุต ุงูููุฏูู
   ```

3. **ูุต ุงูููุฏูู ุจุงุณุชุฎุฏุงู FFmpeg**

   ```bash
   # ุงูุทุฑููุฉ ุงูุฃููู: copy codecs (ุฃุณุฑุน)
   ffmpeg -i input.mp4 -t 60 -c copy -avoid_negative_ts make_zero -y output.mp4

   # ุงูุทุฑููุฉ ุงูุซุงููุฉ: re-encoding (ุฅุฐุง ูุดูุช ุงูุฃููู)
   ffmpeg -i input.mp4 -t 60 -c:v libx264 -c:a aac -preset fast -crf 23 -y output.mp4
   ```

4. **ุญูุธ ุงูููุฏูู ุงูููุทูุน**
   ```python
   serializer.save(
       user=user,
       file=trimmed_file,
       media_type='video',
       duration=60,
       is_trimmed=True
   )
   ```

## ๐ก๏ธ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### ุงูุฃุฎุทุงุก ุงููุญุชููุฉ ูุญููููุง:

| ุงููุดููุฉ              | ุงูุญู                              |
| -------------------- | --------------------------------- |
| FFmpeg ุบูุฑ ูุซุจุช      | ุชุซุจูุช FFmpeg                      |
| ูุดู copy codecs      | ุงูุงูุชูุงู ุชููุงุฆูุงู ุฅูู re-encoding |
| ููู ุงูููุฏูู ุชุงูู     | ุญูุธ ุงูููู ุงูุฃุตูู                  |
| ุนุฏู ูุฌูุฏ ูุณุงุญุฉ ูุงููุฉ | ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ             |

## ๐ ูุฑุงูุจุฉ ุงูุฃุฏุงุก

### ุณุฌูุงุช ุงููุธุงู:

```bash
# ูุฑุงูุจุฉ ุณุฌูุงุช ูุนุงูุฌุฉ ุงูููุฏูู
tail -f video_processing.log
```

### ูุคุดุฑุงุช ุงูุฃุฏุงุก:

- **ููุช ุงููุนุงูุฌุฉ:** 1-5 ุซูุงูู ููููุฏูู
- **ุญุฌู ุงูููู:** ุชูููู ุจูุณุจุฉ 60-80%
- **ุฌูุฏุฉ ุงูููุฏูู:** ูุญููุธุฉ ุนูุฏ ุงุณุชุฎุฏุงู copy codecs

## ๐ ุงูุฃูุงู

### ุฅุฌุฑุงุกุงุช ุงูุฃูุงู:

1. **ุงูุชุญูู ูู ููุน ุงูููู**
2. **ุญุฏูุฏ ุญุฌู ุงูููู** (100MB)
3. **ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ**
4. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุขููุฉ**

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ:

1. **ุงูููุฏูู ูุง ูุชู ูุตู**

   - ุชุญูู ูู ุชุซุจูุช FFmpeg
   - ุชุญูู ูู ุตูุงุญูุงุช ุงููููุงุช
   - ุฑุงุฌุน ุณุฌูุงุช ุงูุฃุฎุทุงุก

2. **ุฌูุฏุฉ ุงูููุฏูู ููุฎูุถุฉ**

   - ุงุณุชุฎุฏู re-encoding ุจุฏูุงู ูู copy
   - ุงุถุจุท ุฅุนุฏุงุฏุงุช ุงูุฌูุฏุฉ

3. **ุจุทุก ุงููุนุงูุฌุฉ**
   - ุงุณุชุฎุฏู copy codecs
   - ููู ุฏูุฉ ุงูููุฏูู
   - ุงุณุชุฎุฏู ุฎุงุฏู ุฃููู

## ๐ ูุซุงู ุนููู

### ุฅูุดุงุก ููุฏูู ุชุฌุฑูุจู:

```bash
# ุฅูุดุงุก ููุฏูู ุชุฌุฑูุจู ูุฏุชู 90 ุซุงููุฉ
ffmpeg -f lavfi -i testsrc=duration=90:size=640x480:rate=30 \
       -f lavfi -i sine=frequency=1000:duration=90 \
       -c:v libx264 -c:a aac -y test_video.mp4
```

### ุงุฎุชุจุงุฑ ุงููุต:

```bash
cd backend/story
python simple_test.py
```

## ๐ ุงูุฏุนู

ูููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงูู:

- ุฑุงุฌุน ุณุฌูุงุช ุงูุฃุฎุทุงุก
- ุชุญูู ูู ุฅุนุฏุงุฏุงุช FFmpeg
- ุชุฃูุฏ ูู ุตูุงุญูุงุช ุงููููุงุช
- ุฑุงุฌุน ููู `VIDEO_TRIMMING_GUIDE.md` ููุญุตูู ุนูู ุฏููู ููุตู

---

**๐ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**
