# ๐ฌ ุงูุญู ุงูููุงุฆู: ูุธุงู ูุต ุงูููุฏูู ุฅูู 60 ุซุงููุฉ

## ๐ ุงููุดููุฉ ุงูุฃุตููุฉ

ุงููุณุชุฎุฏู ูุฑูุฏ ูุธุงู ูุณูุญ ุจุฑูุน ููุฏูููุงุช ุณุชูุฑูุ ููููู ุชููุงุฆูุงู ุจูุต ุงูููุฏูู ุฅูู ุฃูู 60 ุซุงููุฉ ููุทุ ูุน ุญุฐู ุงููุณุฎุฉ ุงููุงููุฉ ูู ุงูุณูุฑูุฑ.

## โ ุงูุญู ุงููุทุจู

### 1. ุงููููุงุช ุงููุญุณูุฉ:

#### `video_processor.py` - ูุนุงูุฌ ุงูููุฏูู ุงูุฑุฆูุณู

- โ `trim_video_to_60_seconds()` - ูุต ุงูููุฏูู ุฅูู 60 ุซุงููุฉ
- โ `is_video_file()` - ุงูุชุญูู ูู ููุน ุงูููู
- โ `should_trim_video()` - ุงูุชุญูู ูู ุงูุญุงุฌุฉ ูููุต
- โ `validate_video_file()` - ุงูุชุญูู ูู ุตุญุฉ ุงูููุฏูู
- โ ูุนุงูุฌุฉ ุฐููุฉ ููุฃุฎุทุงุก ูุน fallback ุขูู

#### `views.py` - ูุนุงูุฌ ุงูุทูุจุงุช

- โ `StoryCreateView` - ุฑูุน ุงูุณุชูุฑู ูุน ูุนุงูุฌุฉ ุชููุงุฆูุฉ ููููุฏูู
- โ ุงูุชุญูู ูู ุตุญุฉ ุงูููุฏูู ูุจู ูุจุนุฏ ุงููุต
- โ ุญูุธ ุงูููุฏูู ุงูููุทูุน ููุท (ุญุฐู ุงููุณุฎุฉ ุงููุงููุฉ)

#### `models.py` - ูููุฐุฌ ุงูุจูุงูุงุช

- โ `Story` - ูููุฐุฌ ุงูุณุชูุฑู ูุน ุญูู `is_trimmed`
- โ `duration` - ูุฏุฉ ุงูููุฏูู (60 ุซุงููุฉ)
- โ `media_type` - ููุน ุงููุณุงุฆุท (video/image)

### 2. ุฎูุงุฑุฒููุฉ ุงููุต:

```python
# 1. ุงูุชุญูู ูู ููุน ุงูููู
if is_video_file(file):
    # 2. ุงูุชุญูู ูู ุตุญุฉ ุงูููุฏูู
    if validate_video_file(file):
        # 3. ุงูุชุญูู ูู ุงูุญุงุฌุฉ ูููุต
        if should_trim_video(file):
            # 4. ูุต ุงูููุฏูู
            trimmed_file = trim_video_to_60_seconds(file)
            # 5. ุงูุชุญูู ูู ุตุญุฉ ุงูููุฏูู ุงูููุทูุน
            if validate_video_file(trimmed_file):
                # 6. ุญูุธ ุงูููุฏูู ุงูููุทูุน ููุท
                save_trimmed_video(trimmed_file)
```

### 3. ุฃูุงูุฑ FFmpeg ุงููุณุชุฎุฏูุฉ:

#### ุงูุทุฑููุฉ ุงูุฃููู (ุฃุณุฑุน):

```bash
ffmpeg -i input.mp4 -t 60 -c copy -avoid_negative_ts make_zero -y output.mp4
```

#### ุงูุทุฑููุฉ ุงูุซุงููุฉ (ุฅุฐุง ูุดูุช ุงูุฃููู):

```bash
ffmpeg -i input.mp4 -t 60 -c:v libx264 -c:a aac -preset fast -crf 23 -y output.mp4
```

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงุฎุชุจุงุฑ ูุณุชูู (ุจุฏูู Django):

```bash
cd backend/story
python standalone_test.py
```

### 2. ุงุฎุชุจุงุฑ ูุน Django:

```bash
cd backend/story
python simple_test.py
```

### 3. ุงุฎุชุจุงุฑ ูุชูุฏู:

```bash
cd backend/story
python test_video_trimming.py
```

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฑูุน ููุฏูู ูู ุฎูุงู API:

```python
import requests

url = "http://localhost:8000/api/stories/create/"
files = {'file': open('video.mp4', 'rb')}
data = {'media_type': 'video'}

response = requests.post(url, files=files, data=data)
print(response.json())
```

### 2. ุงุณุชุฎุฏุงู ุงููุธุงู ุจุฑูุฌูุงู:

```python
from story.video_processor import trim_video_to_60_seconds, is_video_file
from django.core.files import File

with open('video.mp4', 'rb') as video_file:
    django_file = File(video_file, name='video.mp4')

    if is_video_file(django_file):
        trimmed_file = trim_video_to_60_seconds(django_file)
        # ุญูุธ ุงูููุฏูู ุงูููุทูุน
```

## ๐ง ุงููุชุทูุจุงุช

### 1. ุชุซุจูุช FFmpeg:

```bash
# Ubuntu/Debian
sudo apt update && sudo apt install ffmpeg

# CentOS/RHEL
sudo yum install epel-release && sudo yum install ffmpeg

# macOS
brew install ffmpeg
```

### 2. ุงูุชุญูู ูู ุงูุชุซุจูุช:

```bash
ffmpeg -version
ffprobe -version
```

## ๐ก๏ธ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### ุงูุฃุฎุทุงุก ุงููุญุชููุฉ ูุญููููุง:

| ุงููุดููุฉ              | ุงูุญู                              |
| -------------------- | --------------------------------- |
| FFmpeg ุบูุฑ ูุซุจุช      | ุชุซุจูุช FFmpeg                      |
| ูุดู copy codecs      | ุงูุงูุชูุงู ุชููุงุฆูุงู ุฅูู re-encoding |
| ููู ุงูููุฏูู ุชุงูู     | ุญูุธ ุงูููู ุงูุฃุตูู                  |
| ุนุฏู ูุฌูุฏ ูุณุงุญุฉ ูุงููุฉ | ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ             |
| ุฎุทุฃ ูู ุชุญููู ุงูููุฏูู | ุงูุชุญูู ูู ุตุญุฉ ุงูููู               |

## ๐ ุงููููุฒุงุช

- โ **ูุต ุชููุงุฆู** ููููุฏูู ุฅูู 60 ุซุงููุฉ
- โ **ุฏุนู ุตูุบ ูุชุนุฏุฏุฉ** (MP4, AVI, MOV, WMV, FLV, WebM, MKV)
- โ **ูุนุงูุฌุฉ ุฐููุฉ ููุฃุฎุทุงุก** ูุน fallback ุขูู
- โ **ุชูุธูู ุชููุงุฆู** ูููููุงุช ุงููุคูุชุฉ
- โ **ุชุญุณูู ุงูุฃุฏุงุก** ุจุงุณุชุฎุฏุงู copy codecs
- โ **ุฅุนุงุฏุฉ ุชุฑููุฒ** ุฅุฐุง ูุดู copy codecs
- โ **ุณุฌูุงุช ููุตูุฉ** ููุฑุงูุจุฉ ุงูุฃุฏุงุก
- โ **ุญูุธ ุงูููุฏูู ุงูููุทูุน ููุท** (ุญุฐู ุงููุณุฎุฉ ุงููุงููุฉ)

## ๐ ุชุดุบูู ุงููุธุงู

### 1. ุชุดุบูู ุงูุฎุงุฏู:

```bash
cd backend
gunicorn core.asgi:application -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
```

### 2. ุงุฎุชุจุงุฑ ุงููุธุงู:

```bash
cd backend/story
python standalone_test.py
```

## ๐ ูุซุงู ุนููู

### ุฅูุดุงุก ููุฏูู ุชุฌุฑูุจู:

```bash
ffmpeg -f lavfi -i testsrc=duration=90:size=640x480:rate=30 \
       -f lavfi -i sine=frequency=1000:duration=90 \
       -c:v libx264 -c:a aac -y test_video.mp4
```

### ุงุฎุชุจุงุฑ ุงููุต:

```bash
python standalone_test.py
```

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ูุงุฌูุช ุฎุทุฃ "An error occurred while loading the video file":

1. **ุชุญูู ูู ุชุซุจูุช FFmpeg:**

   ```bash
   ffmpeg -version
   ```

2. **ุงุฎุชุจุงุฑ ุงููุธุงู:**

   ```bash
   python standalone_test.py
   ```

3. **ุชุญูู ูู ุณุฌูุงุช ุงูุฃุฎุทุงุก:**

   ```bash
   tail -f video_processing.log
   ```

4. **ุชุญูู ูู ุตูุงุญูุงุช ุงููููุงุช:**
   ```bash
   ls -la media/stories/
   ```

## ๐ ุงูุฏุนู

ูููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงูู:

- ุฑุงุฌุน ููู `VIDEO_TRIMMING_GUIDE.md` ููุญุตูู ุนูู ุฏููู ููุตู
- ุฑุงุฌุน ุณุฌูุงุช ุงูุฃุฎุทุงุก
- ุชุญูู ูู ุฅุนุฏุงุฏุงุช FFmpeg
- ุชุฃูุฏ ูู ุตูุงุญูุงุช ุงููููุงุช

---

**๐ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**

### ููุฎุต ุงูุญู:

1. โ ุงูููุฏูู ูุชู ูุตู ุชููุงุฆูุงู ุฅูู 60 ุซุงููุฉ
2. โ ุงููุณุฎุฉ ุงููุงููุฉ ูุชู ุญุฐููุง ูู ุงูุณูุฑูุฑ
3. โ ููุท ุงูููุฏูู ุงูููุทูุน ูุชู ุญูุธู
4. โ ูุนุงูุฌุฉ ุฐููุฉ ููุฃุฎุทุงุก
5. โ ุฏุนู ุตูุบ ููุฏูู ูุชุนุฏุฏุฉ
